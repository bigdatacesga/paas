#!/bin/bash
if [[ $# != 1 ]]; then 
	echo "Usage: $0 <service>"
	exit
fi

SERVICE=$1
CONTAINER_HOSTNAME=`hostname -s`-${SERVICE}.lan.cesga.es
CONTAINER_IP=`host $CONTAINER_HOSTNAME | awk '{print $4}'`
PRIVATE_IP="${CONTAINER_IP/117/112}/16"
STORAGE_IP="${CONTAINER_IP}/16"
GATEWAY=10.112.0.1

CONTAINER=$(docker run \
	--net="none"  \
	-h $CONTAINER_HOSTNAME \
	--name test$CONTAINER_HOSTNAME \
	-v /storage/${SERVICE}:/data \
	-v /dev/log:/dev/log \
	--privileged \
	-d alcachi/centos66 
	#-d hadoop/fs02-hadoop:20150923-snapshot
)

pipework virbrPRIVATE -i eth1 $CONTAINER $PRIVATE_IP@$GATEWAY
pipework virbrSTORAGE -i eth2 $CONTAINER $STORAGE_IP
